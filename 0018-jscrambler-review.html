<!DOCTYPE html>
<html>
<head>
<title>0018-jscrambler-review.md</title>
<meta http-equiv="Content-type" content="text/html;charset=UTF-8">

<style>
/* https://github.com/microsoft/vscode/blob/master/extensions/markdown-language-features/media/markdown.css */
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

body {
	font-family: var(--vscode-markdown-font-family, -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif);
	font-size: var(--vscode-markdown-font-size, 14px);
	padding: 0 26px;
	line-height: var(--vscode-markdown-line-height, 22px);
	word-wrap: break-word;
}

#code-csp-warning {
	position: fixed;
	top: 0;
	right: 0;
	color: white;
	margin: 16px;
	text-align: center;
	font-size: 12px;
	font-family: sans-serif;
	background-color:#444444;
	cursor: pointer;
	padding: 6px;
	box-shadow: 1px 1px 1px rgba(0,0,0,.25);
}

#code-csp-warning:hover {
	text-decoration: none;
	background-color:#007acc;
	box-shadow: 2px 2px 2px rgba(0,0,0,.25);
}

body.scrollBeyondLastLine {
	margin-bottom: calc(100vh - 22px);
}

body.showEditorSelection .code-line {
	position: relative;
}

body.showEditorSelection .code-active-line:before,
body.showEditorSelection .code-line:hover:before {
	content: "";
	display: block;
	position: absolute;
	top: 0;
	left: -12px;
	height: 100%;
}

body.showEditorSelection li.code-active-line:before,
body.showEditorSelection li.code-line:hover:before {
	left: -30px;
}

.vscode-light.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(0, 0, 0, 0.15);
}

.vscode-light.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(0, 0, 0, 0.40);
}

.vscode-light.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-dark.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 255, 255, 0.4);
}

.vscode-dark.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 255, 255, 0.60);
}

.vscode-dark.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-high-contrast.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 160, 0, 0.7);
}

.vscode-high-contrast.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 160, 0, 1);
}

.vscode-high-contrast.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

img {
	max-width: 100%;
	max-height: 100%;
}

a {
	text-decoration: none;
}

a:hover {
	text-decoration: underline;
}

a:focus,
input:focus,
select:focus,
textarea:focus {
	outline: 1px solid -webkit-focus-ring-color;
	outline-offset: -1px;
}

hr {
	border: 0;
	height: 2px;
	border-bottom: 2px solid;
}

h1 {
	padding-bottom: 0.3em;
	line-height: 1.2;
	border-bottom-width: 1px;
	border-bottom-style: solid;
}

h1, h2, h3 {
	font-weight: normal;
}

table {
	border-collapse: collapse;
}

table > thead > tr > th {
	text-align: left;
	border-bottom: 1px solid;
}

table > thead > tr > th,
table > thead > tr > td,
table > tbody > tr > th,
table > tbody > tr > td {
	padding: 5px 10px;
}

table > tbody > tr + tr > td {
	border-top: 1px solid;
}

blockquote {
	margin: 0 7px 0 5px;
	padding: 0 16px 0 10px;
	border-left-width: 5px;
	border-left-style: solid;
}

code {
	font-family: Menlo, Monaco, Consolas, "Droid Sans Mono", "Courier New", monospace, "Droid Sans Fallback";
	font-size: 1em;
	line-height: 1.357em;
}

body.wordWrap pre {
	white-space: pre-wrap;
}

pre:not(.hljs),
pre.hljs code > div {
	padding: 16px;
	border-radius: 3px;
	overflow: auto;
}

pre code {
	color: var(--vscode-editor-foreground);
	tab-size: 4;
}

/** Theming */

.vscode-light pre {
	background-color: rgba(220, 220, 220, 0.4);
}

.vscode-dark pre {
	background-color: rgba(10, 10, 10, 0.4);
}

.vscode-high-contrast pre {
	background-color: rgb(0, 0, 0);
}

.vscode-high-contrast h1 {
	border-color: rgb(0, 0, 0);
}

.vscode-light table > thead > tr > th {
	border-color: rgba(0, 0, 0, 0.69);
}

.vscode-dark table > thead > tr > th {
	border-color: rgba(255, 255, 255, 0.69);
}

.vscode-light h1,
.vscode-light hr,
.vscode-light table > tbody > tr + tr > td {
	border-color: rgba(0, 0, 0, 0.18);
}

.vscode-dark h1,
.vscode-dark hr,
.vscode-dark table > tbody > tr + tr > td {
	border-color: rgba(255, 255, 255, 0.18);
}

</style>

<style>
/* Tomorrow Theme */
/* http://jmblog.github.com/color-themes-for-google-code-highlightjs */
/* Original theme - https://github.com/chriskempson/tomorrow-theme */

/* Tomorrow Comment */
.hljs-comment,
.hljs-quote {
	color: #8e908c;
}

/* Tomorrow Red */
.hljs-variable,
.hljs-template-variable,
.hljs-tag,
.hljs-name,
.hljs-selector-id,
.hljs-selector-class,
.hljs-regexp,
.hljs-deletion {
	color: #c82829;
}

/* Tomorrow Orange */
.hljs-number,
.hljs-built_in,
.hljs-builtin-name,
.hljs-literal,
.hljs-type,
.hljs-params,
.hljs-meta,
.hljs-link {
	color: #f5871f;
}

/* Tomorrow Yellow */
.hljs-attribute {
	color: #eab700;
}

/* Tomorrow Green */
.hljs-string,
.hljs-symbol,
.hljs-bullet,
.hljs-addition {
	color: #718c00;
}

/* Tomorrow Blue */
.hljs-title,
.hljs-section {
	color: #4271ae;
}

/* Tomorrow Purple */
.hljs-keyword,
.hljs-selector-tag {
	color: #8959a8;
}

.hljs {
	display: block;
	overflow-x: auto;
	color: #4d4d4c;
	padding: 0.5em;
}

.hljs-emphasis {
	font-style: italic;
}

.hljs-strong {
	font-weight: bold;
}
</style>

<style>
/*
 * Markdown PDF CSS
 */

 body {
	font-family: -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif, "Meiryo";
	padding: 0 12px;
}

pre {
	background-color: #f8f8f8;
	border: 1px solid #cccccc;
	border-radius: 3px;
	overflow-x: auto;
	white-space: pre-wrap;
	overflow-wrap: break-word;
}

pre:not(.hljs) {
	padding: 23px;
	line-height: 19px;
}

blockquote {
	background: rgba(127, 127, 127, 0.1);
	border-color: rgba(0, 122, 204, 0.5);
}

.emoji {
	height: 1.4em;
}

code {
	font-size: 14px;
	line-height: 19px;
}

/* for inline code */
:not(pre):not(.hljs) > code {
	color: #C9AE75; /* Change the old color so it seems less like an error */
	font-size: inherit;
}

/* Page Break : use <div class="page"/> to insert page break
-------------------------------------------------------- */
.page {
	page-break-after: always;
}

</style>

<script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
</head>
<body>
  <script>
    mermaid.initialize({
      startOnLoad: true,
      theme: document.body.classList.contains('vscode-dark') || document.body.classList.contains('vscode-high-contrast')
          ? 'dark'
          : 'default'
    });
  </script>
<h1 id="jscrambler-review">JScrambler Review</h1>
<p>Published: May 5, 2019</p>
<p>I've recently been working on JavaScript Obfuscation.  I've read as much as I can from the internet about options and capabilities.  It is clear there is one winner out of all the offerings available.</p>
<p>JScrambler (<a href="https://jscambler.com">https://jscrambler.com/</a>) is a paid product featuring JavaScript Obfuscation capabilities. When it comes to obfuscating JavaScript, it is the gold standard.</p>
<p>This is what the internet proclaimed as I read it [1].  However, it was truly difficult to assess how accurate these claims are; essentially the only public obfuscation examples they provide are:</p>
<p><a href="https://jscrambler.com/products/code-integrity/javascript-obfuscation">https://jscrambler.com/products/code-integrity/javascript-obfuscation</a></p>
<p>A single, ten line example.  This was not enough for me to make any decisions or really come up with any valuable insight with.</p>
<p>I needed more.  So I thought to myself, <strong>Where can I find more???</strong></p>
<p>Turns out like any good technology company, <strong>JScrambler</strong> dogfoods their own product.  So I present to you more fully-featured examples of their obfuscation prowess:</p>
<ul>
<li><a href="https://jscrambler.com/bundle.js">https://jscrambler.com/bundle.js</a> [2] - This is the primary marketing site JavaScript - run thru their own obfuscation technology, presumably.</li>
<li><a href="https://jscrambler.com/vendor.bundle.js">https://jscrambler.com/vendor.bundle.js</a> [3] - This is the vendor dependencies that the client side application relies on to do its thing.</li>
</ul>
<p>Now as of this writing the first is 81289 lines of code <em>prettified</em> and the second is 66944 <em>prettified</em>.</p>
<p>That is some serious obfuscation! Now I can begin more nuanced evaluation of their obfuscation technology (and so can you!), but if you would like more examples they have bountiful subdomains hosting obfuscated code!</p>
<ul>
<li><a href="https://app.jscrambler.com/bundle.5.6.11.js">https://app.jscrambler.com/bundle.5.6.11.js</a> [4] - 435995 lines <em>prettified</em>.</li>
</ul>
<h2 id="first-things-first">First Things First</h2>
<p>Let's get our source material in more <em>readable</em> form.  I used <a href="https://beautifier.io/">https://beautifier.io/</a> and it worked like a champ in <em>prettifying</em> the source material.  This only makes it slight more readable, but anything other than a single line of JS is preferable to the alternative.</p>
<p>I will note that Chrome struggled a bit trying to export the prettified source code.  I used <strong>DevTools</strong> to <em>prettify</em> the source right in the browser, but when I clicked <code>Save As</code> I was greeted with an unresponsive browser.</p>
<p>Right off the bat I notice a few things:</p>
<ul>
<li>The control flow flattening is amazing</li>
<li>There is no string obfuscation / encryption.</li>
</ul>
<p>This second point is more important than one might imagine.  Just like in binary reverse engineering, strings serve as a sort of guide through an application, and having those symbols readily available makes reverse engineering much easier.</p>
<p>Also if one has somewhat sensitive data in a client side application, the lack of string protection is a big deal, as i was able to find the jscrambler gitlab server address and application path easily despite the obfuscation. Ditto for the host name of the jscrambler npm mirror.</p>
<p>Now lets talk about the first point. Control flow flattening hides the business logic of an application, and jscrambler does a great job here. Static analysis isn't going to help here, we will need a full debugger.  All logic here is written as <code>switch</code> statements, which effectively masks the underlying, <em>unobfuscated</em> logic.  In addition, jscrambler adds <code>case</code> statements that do not correspond to anything in the original code, a feat known as <em>dead code injection</em>.</p>
<p><a href="https://gist.github.com/nstarke/4f0eba4d1765b9d48fe884301cd5aedf">Using a technique I developed previously</a> [5] I exract all of the strings in the <code>bundle.6.5.11-beautified.js</code> file.</p>
<p>Let's take a look at some of the things that pop out:</p>
<ul>
<li><code>&quot;SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED&quot;</code></li>
</ul>
<p>Well that certainly looks interesting, you should check it out if you are interested.</p>
<h2 id="i-believe">I Believe</h2>
<p>Now is as good of a time as any to say that I believe in obfuscation as a strategy and deterent against reverse engineering, as well as a means for bypassing antivirus (we won't go into that today though). More importantly, bad guys certainly believe in obfuscation because they use it all the time to try to deter reverse engineering by white hat malware analysts who catalog these things legitimately to protect businesses, individuals, and governments.</p>
<p>It is important to recognize the limitations though of this technique.  Secrets, such as cryptographic keys or passphrases, will never be safe on the client and obfuscation should not be used to try to make them so.  Any mission critical proprietary software should stay on the server.</p>
<p>I say all of this because there are <a href="https://www.reddit.com/r/javascript/comments/3b9zg6/how_to_secure_js_source_for_packaged_apps/">a</a> <a href="https://www.reddit.com/r/javascript/comments/5v5qv1/looking_for_a_js_obfuscator_which_renames/">lot</a> <a href="https://www.reddit.com/r/javascript/comments/ug50h/horriblejs_a_javascript_code_obfuscator_that/">of</a> <a href="https://www.reddit.com/r/javascript/comments/88pavs/is_javascript_obfuscation_useless/">people</a> [6] [7] [8] [9] who do not think JavaScript obfuscation has any valid purpose.</p>
<p>I should also probably note that I have never signed up for a Jscrambler account and am thus not bound by their terms of service in any way.  You can read the terms of service <a href="https://docs.jscrambler.com/privacy-and-security/terms-of-service">here</a> [10], but I'm not seeing anything related to reverse engineering in there.  I think this is a net positive and demonstrates that the company stands by its product and its capabilities.  However I am not a lawyer and if you have any questions on their terms of service you should consult a lawyer and <strong>not me</strong>.</p>
<p>Along those lines its also worth mentioning that I have no relationship with Jscrambler, any of its executives, investors, or employees, and am not being paid by <strong>anyone</strong> for this analysis.</p>
<h2 id="back-to-regularly-obfuscated-programming">Back to regularly obfuscated programming</h2>
<p>Now that that is out of the way, let's continue our journey.  Harking back to the unencrypted / obfuscated strings issue, we can compile a list of api endpoints by some string analysis on the app.  I won't document them exhaustively here, but if you are following along, you can search your <em>prettified</em> code for strings like</p>
<ul>
<li><code>api</code></li>
<li><code>application</code></li>
</ul>
<p>It is even possible to discern what HTTP method is used for each route.</p>
<p>Other things to note is that browser defined APIs - such as everything that hangs off the <code>window</code> object, are not obfuscated either.  There are definitely ways of doing this and I was disappointed to see that certain object functions and properties were unobfuscated throughout the obfuscated files.</p>
<h2 id="summary">Summary</h2>
<p>It is clear to me that the magic that transforms the input code all occurs on the server side and nothing of that nature is included in the obfuscated client-side files available currently.  Overall I would say any given portion of the application is essentially non-understandable by simply reading the code (without debugging through it).  However, it is possible to get an overall idea of what the application does, maybe not in complete detail, because strings are not obfuscated or encrypted in any way.  I do think that obfuscated software deters casual reverse engineering, but whether it would deter let's say a nation-state actor with nation-state resources, the jury is out on that one.</p>
<h3 id="sources">Sources:</h3>
<p>[1] <a href="https://www.huffpost.com/entry/the-integrity-of-your-jav_b_10218176">https://www.huffpost.com/entry/the-integrity-of-your-jav_b_10218176</a></p>
<p>[2] <a href="https://web.archive.org/web/20190427002248/https://jscrambler.com/bundle.js">https://web.archive.org/web/20190427002248/https://jscrambler.com/bundle.js</a></p>
<p>[3] <a href="https://web.archive.org/web/20190427001957/https://jscrambler.com/vendor.bundle.js">https://web.archive.org/web/20190427001957/https://jscrambler.com/vendor.bundle.js</a></p>
<p>[4] <a href="https://web.archive.org/web/20190505170802/https://app.jscrambler.com/bundle.5.6.11.js">https://web.archive.org/web/20190505170802/https://app.jscrambler.com/bundle.5.6.11.js</a></p>
<p>[5] <a href="https://gist.github.com/nstarke/4f0eba4d1765b9d48fe884301cd5aedf0">https://gist.github.com/nstarke/4f0eba4d1765b9d48fe884301cd5aedf</a></p>
<p>[6] <a href="https://www.reddit.com/r/javascript/comments/3b9zg6/how_to_secure_js_source_for_packaged_apps/">https://www.reddit.com/r/javascript/comments/3b9zg6/how_to_secure_js_source_for_packaged_apps/</a></p>
<p>[7] <a href="https://www.reddit.com/r/javascript/comments/5v5qv1/looking_for_a_js_obfuscator_which_renames/">https://www.reddit.com/r/javascript/comments/5v5qv1/looking_for_a_js_obfuscator_which_renames/</a></p>
<p>[8] <a href="https://www.reddit.com/r/javascript/comments/ug50h/horriblejs_a_javascript_code_obfuscator_that/">https://www.reddit.com/r/javascript/comments/ug50h/horriblejs_a_javascript_code_obfuscator_that/</a></p>
<p>[9] <a href="https://www.reddit.com/r/javascript/comments/88pavs/is_javascript_obfuscation_useless/">https://www.reddit.com/r/javascript/comments/88pavs/is_javascript_obfuscation_useless/</a></p>
<p>[10] <a href="https://docs.jscrambler.com/privacy-and-security/terms-of-service">https://docs.jscrambler.com/privacy-and-security/terms-of-service</a></p>
<p><a href="https://nstarke.github.io/">Back</a></p>

</body>
</html>
